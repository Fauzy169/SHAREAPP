const CACHE_NAME="StoryApp-V3",API_CACHE_NAME="StoryApp-API-V1",ASSETS_TO_CACHE=["/SHAREAPP/","/SHAREAPP/index.html","/SHAREAPP/favicon.png","/SHAREAPP/manifest.json","/SHAREAPP/app.bundle.js","/SHAREAPP/sw.bundle.js","/SHAREAPP/icons/icon-192.png","/SHAREAPP/icons/icon-512.png"],EXTERNAL_RESOURCES=["https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"];self.addEventListener("install",(t=>{t.waitUntil((async()=>{try{const t=await caches.open(CACHE_NAME);for(const e of ASSETS_TO_CACHE)try{await t.add(e)}catch(t){console.warn(`‚ö†Ô∏è Gagal cache local: ${e}`,t)}for(const e of EXTERNAL_RESOURCES)try{const n=await fetch(e);n.ok?await t.put(e,n):console.warn(`‚ö†Ô∏è Respon gagal untuk ${e}: ${n.status}`)}catch(t){console.warn(`‚ö†Ô∏è Gagal fetch eksternal: ${e}`,t)}console.log("‚úÖ Service worker install selesai")}catch(t){console.error("üö´ Cache installation failed:",t)}})())})),self.addEventListener("fetch",(t=>{const{request:e}=t;new URL(e.url).pathname.startsWith("/api/")?t.respondWith((async()=>{try{const t=await fetch(e);return(await caches.open(API_CACHE_NAME)).put(e,t.clone()),t}catch(t){return await caches.match(e)||new Response(JSON.stringify({error:"Offline mode"}),{headers:{"Content-Type":"application/json"}})}})()):t.respondWith(caches.match(e).then((t=>t||fetch(e).catch((()=>{if("navigate"===e.mode)return caches.match("/index.html")})))))})),self.addEventListener("activate",(t=>{t.waitUntil(caches.keys().then((t=>Promise.all(t.filter((t=>t!==CACHE_NAME&&t!==API_CACHE_NAME)).map((t=>caches.delete(t)))))))})),self.addEventListener("push",(t=>{const e=t.data?.json()||{title:"New Story",body:"A new story has been posted!"};t.waitUntil(self.registration.showNotification(e.title,{body:e.body,icon:"/SHAREAPP/icons/icon-192.png",vibrate:[200,100,200]}))})),self.addEventListener("sync",(t=>{"sync-stories"===t.tag&&t.waitUntil((async()=>{console.log("‚è≥ Syncing offline stories...")})())}));