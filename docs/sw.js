const CACHE_NAME="StoryApp-V2",ASSETS_TO_CACHE=["/SHAREAPP/","/SHAREAPP/index.html","/SHAREAPP/favicon.png","/SHAREAPP/manifest.json","/SHAREAPP/app.bundle.js","/SHAREAPP/sw.bundle.js","/SHAREAPP/icons/icon-192.png","/SHAREAPP/icons/icon-512.png","https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"];async function syncOfflineStories(){const e=await getAllData();for(const t of e){const e=new FormData;for(const n in t)e.append(n,t[n]);try{(await fetch(`${CONFIG.BASE_URL}/stories`,{method:"POST",headers:{Authorization:`Bearer ${t.isGuest?"":localStorage.getItem(CONFIG.USER_TOKEN_KEY)}`},body:e})).ok&&(await deleteData(t.id),console.log(`Cerita offline "${t.id}" berhasil disinkronkan.`))}catch(e){console.error(`Gagal menyinkronkan cerita offline "${t.id}":`,e)}}}self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(ASSETS_TO_CACHE))).catch((e=>{console.error("Cache error:",e)})))})),self.addEventListener("fetch",(e=>{const{request:t}=e;new URL(t.url).pathname.startsWith("/api/")?e.respondWith(caches.match(t).then((e=>e||fetch(t).then((e=>{const n=e.clone();return caches.open(CACHE_NAME).then((e=>{e.put(t,n)})),e}))))):e.respondWith(caches.match(t).then((e=>e||fetch(t).catch((()=>{if("navigate"===t.mode)return caches.match("/SHAREAPP/index.html")})))))})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==CACHE_NAME)).map((e=>caches.delete(e)))))))})),self.addEventListener("push",(e=>{const t=e.data?.json()||{title:"New Story",body:"A new story has been posted!"};e.waitUntil(self.registration.showNotification(t.title,{body:t.body,icon:"/SHAREAPP/icons/icon-192.png",vibrate:[200,100,200]}))})),self.addEventListener("sync",(e=>{"sync-offline-stories"===e.tag&&(console.log("Sync event triggered"),e.waitUntil(syncOfflineStories()))}));