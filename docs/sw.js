const CACHE_NAME="StoryApp-V3",API_CACHE_NAME="StoryApp-API-V1",ASSETS_TO_CACHE=["/","/index.html","/favicon.png","/manifest.json","/app.bundle.js","/sw.bundle.js","/icons/icon-192.png","/icons/icon-512.png","https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"];self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(ASSETS_TO_CACHE))).then((()=>self.skipWaiting())))})),self.addEventListener("fetch",(e=>{const{request:t}=e;new URL(t.url).pathname.startsWith("/api/")?e.respondWith((async()=>{try{const e=await fetch(t);return(await caches.open(API_CACHE_NAME)).put(t,e.clone()),e}catch(e){return await caches.match(t)||new Response(JSON.stringify({error:"Offline mode"}),{headers:{"Content-Type":"application/json"}})}})()):e.respondWith(caches.match(t).then((e=>e||fetch(t).catch((()=>{if("navigate"===t.mode)return caches.match("/index.html")})))))})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==CACHE_NAME&&e!==API_CACHE_NAME)).map((e=>caches.delete(e)))))).then((()=>self.clients.claim())))})),self.addEventListener("push",(e=>{const t=e.data?.json()||{title:"New Story",body:"A new story has been posted!"};e.waitUntil(self.registration.showNotification(t.title,{body:t.body,icon:"/SHAREAPP/icons/icon-192.png",vibrate:[200,100,200]}))})),self.addEventListener("sync",(e=>{"sync-stories"===e.tag&&e.waitUntil((async()=>{console.log("Syncing offline stories...")})())}));